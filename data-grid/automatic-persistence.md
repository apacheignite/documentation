--------------
title: Automatic Persistence
excerpt: Automatically read-through and write-through your domain model to and from database.
--------------

Ignite ships with its own database schema mapping wizard which provides automatic support for integrating with persistence stores. This utility automatically connects to the underlying database and generates all the required XML OR-mapping configuration and Java domain model POJOs.

Ignite also ships with `org.apache.ignite.cache.store.jdbc.CacheJdbcPojoStore`, which is out-of-the-box JDBC implementation of the [IgniteCacheStore](doc:persistent-store) interface, and automatically handles all the write-through and read-through logic.
[block:api-header]
{
  "type": "basic",
  "title": "Database Schema Import"
}
[/block]
To start the wizard for generating database schema mapping, execute `bin/ignite-schema-import.sh` script:
[block:code]
{
  "codes": [
    {
      "code": "$ bin/ignite-schema-import.sh",
      "language": "shell",
      "name": "Shell"
    }
  ]
}
[/block]
This command will bring up a UI wizard which will take you through a couple of screens.

## Connect To Database
The first screen will ask you for database connectivity settings. Note that JDBC drivers **are not supplied** with the utility and should be provided separately.
[block:image]
{
  "images": [
    {
      "image": [
        "https://www.filepicker.io/api/file/7JgX69krRnC7H10vaYTd",
        "ignite-schema-import-01.png",
        "650",
        "497",
        "#d03739",
        ""
      ]
    }
  ]
}
[/block]
## Generate XML Configuration and POJOs
The second screen allows to map database tables to domain model classes and automatically generates XML configurations and POJOs.
[block:image]
{
  "images": [
    {
      "image": [
        "https://www.filepicker.io/api/file/qWiSTnY2QMOISjqFBN56",
        "ignite-schema-import-02.png",
        "650",
        "650",
        "#20608f",
        ""
      ]
    }
  ]
}
[/block]
##Generated Artifacts

The utility generates the following artifacts:
  * Java POJO key and value classes.
  * XML `CacheTypeMetadata` configuration.
  * `ConfigurationSnippet.java` (alternative to XML).

After you exit from the wizard, you should
 1. Copy generated POJO java classes to you project source folder.
 2. Copy XML declaration of `CacheTypeMetadata` to your Ignite XML configuration file under appropriate `CacheConfiguration` root.
 3. Use `ConfigurationSnippet.java` in your Ignite initialization logic.
[block:code]
{
  "codes": [
    {
      "code": "/**\n * PersonKey definition.\n *\n * Code generated by Apache Ignite Schema Import utility: 03/03/2015.\n */\npublic class PersonKey implements Serializable {\n    /** */\n    private static final long serialVersionUID = 0L;\n\n    /** Value for id. */\n    private int id;\n\n    /**\n     * Gets id.\n     *\n     * @return Value for id.\n     */\n    public int getId() {\n        return id;\n    }\n\n    /**\n     * Sets id.\n     *\n     * @param id New value for id.\n     */\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    /** {@inheritDoc} */\n    @Override public boolean equals(Object o) {\n        if (this == o)\n            return true;\n\n        if (!(o instanceof PersonKey))\n            return false;\n\n        PersonKey that = (PersonKey)o;\n\n        if (id != that.id)\n            return false;\n\n        return true;\n    }\n\n    /** {@inheritDoc} */\n    @Override public int hashCode() {\n        int res = id;\n\n        return res;\n    }\n\n    /** {@inheritDoc} */\n    @Override public String toString() {\n        return \"PersonKey [id=\" + id +\n            \"]\";\n    }\n}",
      "language": "java",
      "name": "POJO key class"
    },
    {
      "code": "/**\n * Person definition.\n *\n * Code generated by Apache Ignite Schema Import utility: 03/03/2015.\n */\npublic class Person implements Serializable {\n    /** */\n    private static final long serialVersionUID = 0L;\n\n    /** Value for id. */\n    private int id;\n\n    /** Value for orgId. */\n    private Integer orgId;\n\n    /** Value for name. */\n    private String name;\n\n    /**\n     * Gets id.\n     *\n     * @return Value for id.\n     */\n    public int getId() {\n        return id;\n    }\n\n    /**\n     * Sets id.\n     *\n     * @param id New value for id.\n     */\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    /**\n     * Gets orgId.\n     *\n     * @return Value for orgId.\n     */\n    public Integer getOrgId() {\n        return orgId;\n    }\n\n    /**\n     * Sets orgId.\n     *\n     * @param orgId New value for orgId.\n     */\n    public void setOrgId(Integer orgId) {\n        this.orgId = orgId;\n    }\n\n    /**\n     * Gets name.\n     *\n     * @return Value for name.\n     */\n    public String getName() {\n        return name;\n    }\n\n    /**\n     * Sets name.\n     *\n     * @param name New value for name.\n     */\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    /** {@inheritDoc} */\n    @Override public boolean equals(Object o) {\n        if (this == o)\n            return true;\n\n        if (!(o instanceof Person))\n            return false;\n\n        Person that = (Person)o;\n\n        if (id != that.id)\n            return false;\n\n        if (orgId != null ? !orgId.equals(that.orgId) : that.orgId != null)\n            return false;\n\n        if (name != null ? !name.equals(that.name) : that.name != null)\n            return false;\n\n        return true;\n    }\n\n    /** {@inheritDoc} */\n    @Override public int hashCode() {\n        int res = id;\n\n        res = 31 * res + (orgId != null ? orgId.hashCode() : 0);\n\n        res = 31 * res + (name != null ? name.hashCode() : 0);\n\n        return res;\n    }\n\n    /** {@inheritDoc} */\n    @Override public String toString() {\n        return \"Person [id=\" + id +\n            \", orgId=\" + orgId +\n            \", name=\" + name +\n            \"]\";\n    }\n}",
      "language": "java",
      "name": "POJO value class"
    },
    {
      "code": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:util=\"http://www.springframework.org/schema/util\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\n                           http://www.springframework.org/schema/util\n                           http://www.springframework.org/schema/util/spring-util.xsd\">\n    <bean class=\"org.apache.ignite.cache.CacheTypeMetadata\">\n        <property name=\"databaseSchema\" value=\"PUBLIC\"/>\n        <property name=\"databaseTable\" value=\"PERSON\"/>\n        <property name=\"keyType\" value=\"org.apache.ignite.examples.datagrid.store.model.PersonKey\"/>\n        <property name=\"valueType\" value=\"org.apache.ignite.examples.datagrid.store.model.Person\"/>\n        <property name=\"keyFields\">\n            <list>\n                <bean class=\"org.apache.ignite.cache.CacheTypeFieldMetadata\">\n                    <property name=\"databaseName\" value=\"ID\"/>\n                    <property name=\"databaseType\">\n                        <util:constant static-field=\"java.sql.Types.INTEGER\"/>\n                    </property>\n                    <property name=\"javaName\" value=\"id\"/>\n                    <property name=\"javaType\" value=\"int\"/>\n                </bean>\n            </list>\n        </property>\n        <property name=\"valueFields\">\n            <list>\n                <bean class=\"org.apache.ignite.cache.CacheTypeFieldMetadata\">\n                    <property name=\"databaseName\" value=\"ID\"/>\n                    <property name=\"databaseType\">\n                        <util:constant static-field=\"java.sql.Types.INTEGER\"/>\n                    </property>\n                    <property name=\"javaName\" value=\"id\"/>\n                    <property name=\"javaType\" value=\"int\"/>\n                </bean>\n                <bean class=\"org.apache.ignite.cache.CacheTypeFieldMetadata\">\n                    <property name=\"databaseName\" value=\"ORG_ID\"/>\n                    <property name=\"databaseType\">\n                        <util:constant static-field=\"java.sql.Types.INTEGER\"/>\n                    </property>\n                    <property name=\"javaName\" value=\"orgId\"/>\n                    <property name=\"javaType\" value=\"java.lang.Integer\"/>\n                </bean>\n                <bean class=\"org.apache.ignite.cache.CacheTypeFieldMetadata\">\n                    <property name=\"databaseName\" value=\"NAME\"/>\n                    <property name=\"databaseType\">\n                        <util:constant static-field=\"java.sql.Types.VARCHAR\"/>\n                    </property>\n                    <property name=\"javaName\" value=\"name\"/>\n                    <property name=\"javaType\" value=\"java.lang.String\"/>\n                </bean>\n            </list>\n        </property>\n    </bean>\n</beans>",
      "language": "xml",
      "name": "XML configuration"
    },
    {
      "code": "/**\n * ConfigurationSnippet definition.\n *\n * Code generated by Apache Ignite Schema Import utility: 03/22/2015.\n */\npublic class ConfigurationSnippet {\n  /** Configure cache store. */\n  public static CacheStore store() {\n    DataSource dataSource = null; // TODO create data source.\n\n    CacheJdbcPojoStore store = new CacheJdbcPojoStore();\n    store.setDataSource(dataSource);\n\n    return store;\n  }\n\n  /** Configure cache types metadata. */\n  public static Collection<CacheTypeMetadata> typeMetadata() {\n    // Configure cache types. \n    Collection<CacheTypeMetadata> meta = new ArrayList<>();\n\n    // PERSON.\n    CacheTypeMetadata type = new CacheTypeMetadata();\n    type.setDatabaseSchema(\"PUBLIC\");\n    type.setDatabaseTable(\"PERSON\");\n    type.setKeyType(\"org.apache.ignite.PersonKey\");\n    type.setValueType(\"org.apache.ignite.Person\");\n\n    meta.add(type);\n\n    // Key fields for PERSON.\n    Collection<CacheTypeFieldMetadata> keys = new ArrayList<>();\n    keys.add(new CacheTypeFieldMetadata(\"ID\", Types.INTEGER, \"id\", int.class));\n    type.setKeyFields(keys);\n\n    // Value fields for PERSON.\n    Collection<CacheTypeFieldMetadata> vals = new ArrayList<>();\n    vals.add(new CacheTypeFieldMetadata(\"ID\", Types.INTEGER, \"id\", int.class));\n    vals.add(new CacheTypeFieldMetadata(\"FIRST_NAME\", Types.VARCHAR, \"firstName\", String.class));\n    vals.add(new CacheTypeFieldMetadata(\"LAST_NAME\", Types.VARCHAR, \"lastName\", String.class));\n    type.setValueFields(vals);\n\n\n    return meta;\n  }\n}",
      "language": "java",
      "name": "Java configuration"
    }
  ]
}
[/block]

[block:api-header]
{
  "type": "basic",
  "title": "CacheJdbcPojoStore"
}
[/block]
After you generate XML and POJOs in wizard and copy all necessary stuff into your project you could use `CacheJdbcPojoStore` to load data from database into cache and write data from cache into database.

First you need to properly declare store in configuration:
[block:code]
{
  "codes": [
    {
      "code": "<bean class=\"org.apache.ignite.configuration.IgniteConfiguration\">\n...\n <!-- Cache configuration. -->\n <property name=\"cacheConfiguration\">\n  <list>\n   <bean class=\"org.apache.ignite.configuration.CacheConfiguration\">\n    ...\n    <!-- Cache store. -->\n    <property name=\"cacheStoreFactory\">\n     <bean class=\"javax.cache.configuration.FactoryBuilder$SingletonFactory\">\n      <constructor-arg>\n       <bean class=\"org.apache.ignite.cache.store.jdbc.CacheJdbcPojoStore\">\n        <property name=\"dataSource\">\n         <!-- Sample datasource: in-memory H2 database -->\n         <property name=\"dataSource\">\n          <bean class=\"org.h2.jdbcx.JdbcConnectionPool\" factory-method=\"create\">\n           <constructor-arg value=\"jdbc:h2:tcp://localhost/mem:ExampleDb\"/>\n           <constructor-arg value=\"sa\"/>\n           <constructor-arg value=\"\"/>\n          </bean>\n         </property>\n        </property>\n       </bean>\n      </constructor-arg>\n     </bean>\n    </property>\n\n     <!-- Cache types metadata. -->\n    <property name=\"typeMetadata\">\n     <list>\n     ... Copy here types generated by wizard...\n     </list>\n    </property>\n    \n    <!-- Enable store usage. --> \n    <!-- Sets flag indicating whether read from database is enabled. -->\n    <property name=\"readThrough\" value=\"true\"/>\n     \n    <!-- Sets flag indicating whether write to database is enabled. -->\n    <property name=\"writeThrough\" value=\"true\"/>\n     \n    <!-- Enable database batching. --> \n    <!-- Sets flag indicating whether write-behind is enabled. -->\n    <property name=\"writeBehindEnabled\" value=\"true/>\n  </list>\n </property>\n...\n</bean>",
      "language": "xml"
    },
    {
      "code": "IgniteConfiguration cfg = new IgniteConfiguration();\n...\nCacheConfiguration ccfg = new CacheConfiguration<>();\n\n// Create data source for your database.\n// For example: in-memory H2 database.\nDataSource dataSource = org.h2.jdbcx.JdbcConnectionPool.create(\"jdbc:h2:tcp://localhost/mem:ExampleDb\", \"sa\", \"\");\n\n// Create store. \nCacheJdbcPojoStore store = new CacheJdbcPojoStore();\nstore.setDataSource(dataSource);\n\n// Create store factory. \nccfg.setCacheStoreFactory(new FactoryBuilder.SingletonFactory<>(store));\n\n// Configure cache to use store. \nccfg.setReadThrough(true);\nccfg.setWriteThrough(true);\n\n// Enable database batching.\nccfg.setWriteBehindEnabled(true);\n\ncfg.setCacheConfiguration(ccfg);\n\n// Configure cache types. \nCollection<CacheTypeMetadata> meta = new ArrayList<>();\n... Paste here code generated by wizard ...\n...\n// Start Ignite node.\nIgnition.start(cfg);\n\n",
      "language": "java"
    }
  ]
}
[/block]
All operations defined in [Persistent Store](doc:persistent-store) are available in `CacheJdbcPojoStore`.

`CacheJdbcPojoStore` can effectively load data. To load **all** data from database for all types registered in cache configuration - just call `IgniteCache.loadCache(null)` method. To load data with custom conditions you should pass key types and SQL queries to  `IgniteCache.loadCache()` method. For example:
[block:code]
{
  "codes": [
    {
      "code": "IgniteCache<Long, Person> c = node.jcache(CACHE_NAME);\nc.loadCache(null, \"java.lang.Integer\", \"select * from Person where id > 100\");",
      "language": "java"
    }
  ]
}
[/block]

[block:api-header]
{
  "type": "basic",
  "title": "Example"
}
[/block]
Example `org.apache.ignite.examples.datagrid.store.CacheStoreExample` demonstrates usage of cache store.

In order to run example for automatic persistence you need to set `CacheNodeWithStoreStartup.STORE = AUTO`  and run `CacheStoreExample`.
[block:api-header]
{
  "type": "basic",
  "title": "Demo"
}
[/block]
Lets do step-by-step demo. You can find demo sources in `examples/schema-import` folder.

We will use [H2 database](http://www.h2database.com).

* Start H2 server with following script:
[block:code]
{
  "codes": [
    {
      "code": "$  examples/schema-import/bin/h2-server.sh",
      "language": "shell",
      "name": "Shell"
    }
  ]
}
[/block]
H2 Console will be started in your default browser.

* Connect to H2 with following settings:
  * Select **Generic H2 (Server)** settings.
  * Specify JDBC URL as **jdbc:h2:tcp://localhost/~/schema-import/demo**.

* Click **Connect**.
[block:image]
{
  "images": [
    {
      "image": [
        "https://www.filepicker.io/api/file/LzsAGZm5SI6gujNNJltx",
        "ignite-schema-import-demo-h2.png",
        "456",
        "389",
        "",
        ""
      ]
    }
  ]
}
[/block]
* Paste content of `examples/schema-import/bin/db-init.sql` into H2 Console and execute.

* Start Schema Import Wizard with properties configured for demo:
[block:code]
{
  "codes": [
    {
      "code": " bin/ignite-schema-import.sh examples/schema-import/bin/schema-import.properties",
      "language": "shell",
      "name": "Shell"
    }
  ]
}
[/block]

[block:image]
{
  "images": [
    {
      "image": [
        "https://www.filepicker.io/api/file/KU9EDmkqTU6YZzFiTraO",
        "ignite-schema-import-demo-connect.png",
        "650",
        "650",
        "#e62128",
        ""
      ]
    }
  ]
}
[/block]
 * Click **Next**.
[block:image]
{
  "images": [
    {
      "image": [
        "https://www.filepicker.io/api/file/uDZ9QJroQ8y9b712cIAB",
        "ignite-schema-import-demo-generate.png",
        "650",
        "650",
        "#205f8f",
        ""
      ]
    }
  ]
}
[/block]
* Click  **Generate**. Answer **Yes** for override warnings.

POJO files and java snippets will be generated in `examples/schema-import/src/main/java/org/apache/ignite/schema` folder.

* Import in your favorite IDE **examples/schema-import/pom.xml**.

* Run `Demo.java`.